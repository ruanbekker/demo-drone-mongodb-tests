--
kind: pipeline
name: mongotests

steps:
- name: build-step
  image: alpine
  commands:
  - echo "this should be a step that does something"

services:
- name: mongo
  image: mongo:4
  command: [ --smallfiles ]
  ports:
  - 27017

- name: mongodb-return-version
  image: mongo:4
  commands:
  - sleep 5
  - mongo --host mongo --eval "db.version()"
  - sh scripts/write_mongo.sh
  - sh scripts/read_mongo.sh
  
- name: mongodb-test-writes
  image: mongo:4
  commands:
  - sleep 5
  - mongo --host mongo --eval "db.version()"
  - sh scripts/write_mongo.sh

- name: mongodb-test-reads
  image: mongo:4
  commands:
  - sleep 5
  - sh scripts/read_mongo.sh
